(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[351],{4351:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return J}});var o=t(5893),r=t(7294);const c=(0,r.createContext)(null),i=c.Provider;function l(){const n=(0,r.useContext)(c);if(null==n)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return n}function a(){return l().map}var s=t(5243),u=t.n(s);function d(){return d=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},d.apply(this,arguments)}function f({bounds:n,boundsOptions:e,center:t,children:o,className:c,id:l,placeholder:a,style:u,whenReady:f,zoom:p,...x},m){const[h]=(0,r.useState)({className:c,id:l,style:u}),[b,g]=(0,r.useState)(null);(0,r.useImperativeHandle)(m,(()=>b?.map??null),[b]);const y=(0,r.useCallback)((o=>{if(null!==o&&null===b){const r=new s.Map(o,x);null!=t&&null!=p?r.setView(t,p):null!=n&&r.fitBounds(n,e),null!=f&&r.whenReady(f),g(function(n){return Object.freeze({__version:1,map:n})}(r))}}),[]);(0,r.useEffect)((()=>()=>{b?.map.remove()}),[b]);const v=b?r.createElement(i,{value:b},o):a??null;return r.createElement("div",d({},h,{ref:y}),v)}const p=(0,r.forwardRef)(f);var x=t(3935);function m(n,e,t){return Object.freeze({instance:n,context:e,container:t})}function h(n,e){return null==e?function(e,t){const o=(0,r.useRef)();return o.current||(o.current=n(e,t)),o}:function(t,o){const c=(0,r.useRef)();c.current||(c.current=n(t,o));const i=(0,r.useRef)(t),{instance:l}=c.current;return(0,r.useEffect)((function(){i.current!==t&&(e(l,t,i.current),i.current=t)}),[l,t,o]),c}}function b(n,e){const t=(0,r.useRef)(e);(0,r.useEffect)((function(){e!==t.current&&null!=n.attributionControl&&(null!=t.current&&n.attributionControl.removeAttribution(t.current),null!=e&&n.attributionControl.addAttribution(e)),t.current=e}),[n,e])}function g(n,e){const t=(0,r.useRef)();(0,r.useEffect)((function(){return null!=e&&n.instance.on(e),t.current=e,function(){null!=t.current&&n.instance.off(t.current),t.current=null}}),[n,e])}function y(n,e){const t=n.pane??e.pane;return t?{...n,pane:t}:n}function v(n){return function(e){const t=l(),o=n(y(e,t),t);return b(t.map,e.attribution),g(o.current,e.eventHandlers),function(n,e){(0,r.useEffect)((function(){return(e.layerContainer??e.map).addLayer(n.instance),function(){e.layerContainer?.removeLayer(n.instance),e.map.removeLayer(n.instance)}}),[e,n])}(o.current,t),o}}function j(n,e){const t=function(n,e){return function(t,o){const r=l(),c=n(y(t,r),r);return b(r.map,t.attribution),g(c.current,t.eventHandlers),e(c.current,r,t,o),c}}(h(n),e);return function(n){function e(e,t){const[o,c]=(0,r.useState)(!1),{instance:i}=n(e,c).current;(0,r.useImperativeHandle)(t,(()=>i)),(0,r.useEffect)((function(){o&&i.update()}),[i,o,e.children]);const l=i._contentNode;return l?(0,x.createPortal)(e.children,l):null}return(0,r.forwardRef)(e)}(t)}const C=function(n){function e(e,t){const{instance:o}=n(e).current;return(0,r.useImperativeHandle)(t,(()=>o)),null}return(0,r.forwardRef)(e)}(v(h((function({url:n,...e},t){return m(new s.TileLayer(n,y(e,t)),t)}),(function(n,e,t){!function(n,e,t){const{opacity:o,zIndex:r}=e;null!=o&&o!==t.opacity&&n.setOpacity(o),null!=r&&r!==t.zIndex&&n.setZIndex(r)}(n,e,t);const{url:o}=e;null!=o&&o!==t.url&&n.setUrl(o)}))));t(8570);var w=t(5616),k=t(657),S=t(7645),Z=t(6514),E=t(9417),M=t(5861),O=t(5902),z=t(1425),I=t(8169),L=(0,I.Z)([(0,o.jsx)("circle",{cx:"15.5",cy:"9.5",r:"1.5"},"0"),(0,o.jsx)("circle",{cx:"8.5",cy:"9.5",r:"1.5"},"1"),(0,o.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m-5-6c.78 2.34 2.72 4 5 4s4.22-1.66 5-4z"},"2")],"SentimentVerySatisfied"),A=(0,I.Z)([(0,o.jsx)("circle",{cx:"15.5",cy:"9.5",r:"1.5"},"0"),(0,o.jsx)("circle",{cx:"8.5",cy:"9.5",r:"1.5"},"1"),(0,o.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m0-4c-.73 0-1.38-.18-1.96-.52-.12.14-.86.98-1.01 1.15.86.55 1.87.87 2.97.87 1.11 0 2.12-.33 2.98-.88-.97-1.09-.01-.02-1.01-1.15-.59.35-1.24.53-1.97.53"},"2")],"SentimentSatisfied"),N=(0,I.Z)([(0,o.jsx)("path",{d:"M9 15.5h6v1H9z"},"0"),(0,o.jsx)("circle",{cx:"15.5",cy:"9.5",r:"1.5"},"1"),(0,o.jsx)("circle",{cx:"8.5",cy:"9.5",r:"1.5"},"2"),(0,o.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"3")],"SentimentNeutral"),P=(0,I.Z)([(0,o.jsx)("circle",{cx:"15.5",cy:"9.5",r:"1.5"},"0"),(0,o.jsx)("circle",{cx:"8.5",cy:"9.5",r:"1.5"},"1"),(0,o.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m0-3.5c.73 0 1.39.19 1.97.53.12-.14.86-.98 1.01-1.14-.85-.56-1.87-.89-2.98-.89-1.11 0-2.13.33-2.99.88.97 1.09.01.02 1.01 1.14.59-.33 1.25-.52 1.98-.52"},"2")],"SentimentDissatisfied"),R=(0,I.Z)([(0,o.jsx)("circle",{cx:"15.5",cy:"9.5",r:"1.5"},"0"),(0,o.jsx)("circle",{cx:"8.5",cy:"9.5",r:"1.5"},"1"),(0,o.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m0-6c-2.33 0-4.32 1.45-5.12 3.5h1.67c.69-1.19 1.97-2 3.45-2s2.75.81 3.45 2h1.67c-.8-2.05-2.79-3.5-5.12-3.5"},"2")],"SentimentVeryDissatisfied");const F=function(n,e){return function(n){function e(e,t){const{instance:o,context:c}=n(e).current;return(0,r.useImperativeHandle)(t,(()=>o)),null==e.children?null:r.createElement(i,{value:c},e.children)}return(0,r.forwardRef)(e)}(v(h(n,e)))}((function({position:n,...e},t){const o=new s.Marker(n,e);return m(o,(r=t,c={overlayContainer:o},Object.freeze({...r,...c})));var r,c}),(function(n,e,t){e.position!==t.position&&n.setLatLng(e.position),null!=e.icon&&e.icon!==t.icon&&n.setIcon(e.icon),null!=e.zIndexOffset&&e.zIndexOffset!==t.zIndexOffset&&n.setZIndexOffset(e.zIndexOffset),null!=e.opacity&&e.opacity!==t.opacity&&n.setOpacity(e.opacity),null!=n.dragging&&e.draggable!==t.draggable&&(!0===e.draggable?n.dragging.enable():n.dragging.disable())})),T=j((function(n,e){return m(new s.Tooltip(n,e.overlayContainer),e)}),(function(n,e,{position:t},o){(0,r.useEffect)((function(){const r=e.overlayContainer;if(null==r)return;const{instance:c}=n,i=n=>{n.tooltip===c&&(null!=t&&c.setLatLng(t),c.update(),o(!0))},l=n=>{n.tooltip===c&&o(!1)};return r.on({tooltipopen:i,tooltipclose:l}),r.bindTooltip(c),function(){r.off({tooltipopen:i,tooltipclose:l}),null!=r._map&&r.unbindTooltip()}}),[n,e,o,t])})),H=j((function(n,e){return m(new s.Popup(n,e.overlayContainer),e)}),(function(n,e,{position:t},o){(0,r.useEffect)((function(){const{instance:r}=n;function c(n){n.popup===r&&(r.update(),o(!0))}function i(n){n.popup===r&&o(!1)}return e.map.on({popupopen:c,popupclose:i}),null==e.overlayContainer?(null!=t&&r.setLatLng(t),r.openOn(e.map)):e.overlayContainer.bindPopup(r),function(){e.map.off({popupopen:c,popupclose:i}),e.overlayContainer?.unbindPopup(),e.map.removeLayer(r)}}),[n,e,o,t])}));var _=t(4962);function D(n){let{position:e,mood:t,comment:r,username:c}=n;const{user:i}=(0,_.a)(),l=(a=t.color,u().divIcon({className:"custom-marker",html:'<div style="\n      background-color: '.concat(a,';\n      width: 20px;\n      height: 20px;\n      border-radius: 50%;\n      border: 2px solid white;\n      box-shadow: 0 0 4px rgba(0,0,0,0.3);\n    "></div>'),iconSize:[20,20],iconAnchor:[10,10]}));var a;return(0,o.jsxs)(F,{position:e,icon:l,children:[(0,o.jsx)(T,{permanent:!1,children:(0,o.jsxs)(M.Z,{variant:"subtitle2",sx:{color:t.color},children:[t.label,i&&c&&(0,o.jsxs)(M.Z,{variant:"caption",sx:{color:"black",display:"block",mt:.5},children:["Par : ",c]}),i&&r&&(0,o.jsx)(M.Z,{variant:"body2",sx:{color:"black",mt:.5},children:r})]})}),(0,o.jsxs)(H,{children:[(0,o.jsx)(M.Z,{variant:"subtitle1",sx:{color:t.color},children:t.label}),i&&c&&(0,o.jsxs)(M.Z,{variant:"caption",sx:{color:"black",display:"block",mt:.5},children:["Par : ",c]}),i&&r&&(0,o.jsx)(M.Z,{variant:"body2",sx:{color:"black",mt:1},children:r})]})]})}t(6129);const q="https://votre-api-heroku.herokuapp.com/api",V=[{icon:L,label:"Tr\xe8s heureux",color:"#4CAF50"},{icon:A,label:"Heureux",color:"#8BC34A"},{icon:N,label:"Neutre",color:"#FFC107"},{icon:P,label:"Triste",color:"#FF9800"},{icon:R,label:"Tr\xe8s triste",color:"#F44336"}];function B(n){let{onLocationSelect:e}=n;return function(n){const e=a();(0,r.useEffect)((function(){return e.on(n),function(){e.off(n)}}),[e,n])}({click(n){e(n.latlng)}}),null}function W(){const n=a();return(0,r.useEffect)((()=>{"geolocation"in navigator&&navigator.geolocation.getCurrentPosition((e=>{const{latitude:t,longitude:o}=e.coords;n.setView([t,o],13)}),(n=>{console.log("Erreur de g\xe9olocalisation:",n)}))}),[n]),null}function J(){const[n,e]=(0,r.useState)(null),[t,c]=(0,r.useState)(!1),[i,l]=(0,r.useState)([]),[a,s]=(0,r.useState)(""),[u,d]=(0,r.useState)(null),[f,x]=(0,r.useState)(!0),[m,h]=(0,r.useState)(!1),{user:b,token:g,logout:y}=(0,_.a)();(0,r.useEffect)((()=>{const n=async()=>{try{const n=await fetch("".concat(q,"/markers")),e=await n.json();console.log("Donn\xe9es re\xe7ues du serveur:",e);const t=Array.isArray(e)?e:[];console.log("Marqueurs trait\xe9s:",t),l(t)}catch(n){console.error("Erreur lors du chargement des marqueurs:",n),l([])}finally{x(!1)}};n();const e=setInterval(n,6e4);return()=>clearInterval(e)}),[]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(w.Z,{sx:{height:"100%",width:"100%",position:"relative"},children:(0,o.jsxs)(p,{center:[20,0],zoom:2,style:{height:"100%",width:"100%"},className:"dark-map",children:[(0,o.jsx)(C,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,o.jsx)(B,{onLocationSelect:n=>{b?(e(n),c(!0),s(""),d(null)):h(!0)}}),(0,o.jsx)(W,{}),Array.isArray(i)&&i.map(((n,e)=>(0,o.jsx)(D,{position:[n.position.lat,n.position.lng],mood:n.mood,comment:n.comment,username:n.username},e)))]})}),(0,o.jsxs)(k.Z,{open:t,onClose:()=>c(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{background:"rgba(26, 0, 51, 0.95)",backdropFilter:"blur(10px)",border:"1px solid rgba(147, 51, 234, 0.1)",boxShadow:"0 0 20px rgba(147, 51, 234, 0.2)"}},children:[(0,o.jsx)(S.Z,{sx:{color:"white"},children:"Comment vous sentez-vous \xe0 cet endroit ?"}),(0,o.jsx)(Z.Z,{children:(0,o.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"column",gap:2,p:2},children:[(0,o.jsx)(w.Z,{sx:{display:"flex",justifyContent:"space-around"},children:V.map(((n,e)=>{const t=n.icon;return(0,o.jsxs)(E.Z,{onClick:()=>(n=>{d(n)})(n),sx:{display:"flex",flexDirection:"column",color:n.color,backgroundColor:u===n?"".concat(n.color,"20"):"transparent","&:hover":{backgroundColor:"".concat(n.color,"20")},transition:"all 0.3s ease",transform:u===n?"scale(1.1)":"scale(1)"},children:[(0,o.jsx)(t,{sx:{fontSize:40}}),(0,o.jsx)(M.Z,{variant:"caption",sx:{color:"white"},children:n.label})]},e)}))}),(0,o.jsx)(O.Z,{label:"Ajouter un commentaire (optionnel)",multiline:!0,rows:2,value:a,onChange:n=>s(n.target.value),fullWidth:!0,sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(147, 51, 234, 0.3)"},"&:hover fieldset":{borderColor:"rgba(147, 51, 234, 0.5)"},"&.Mui-focused fieldset":{borderColor:"rgba(147, 51, 234, 0.8)"}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.7)"}}})]})}),(0,o.jsxs)(z.Z,{sx:{p:2},children:[(0,o.jsx)(E.Z,{onClick:()=>c(!1),sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Annuler"}),(0,o.jsx)(E.Z,{onClick:async()=>{if(n&&u){const t={position:{lat:parseFloat(n.lat),lng:parseFloat(n.lng)},mood:{label:u.label,color:u.color},comment:a.trim()};console.log("Donn\xe9es envoy\xe9es au serveur:",JSON.stringify(t,null,2));try{const n=await fetch("".concat(q,"/markers"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(g)},body:JSON.stringify(t)});if(n.ok){const e=await n.json();console.log("Marqueur sauvegard\xe9:",e),l((n=>[...n,e])),c(!1),s(""),d(null)}else{const e=await n.json();console.error("Erreur lors de la sauvegarde du marqueur:",e)}}catch(e){console.error("Erreur lors de la sauvegarde du marqueur:",e)}}},disabled:!u,variant:"contained",sx:{backgroundColor:"rgba(147, 51, 234, 0.8)","&:hover":{backgroundColor:"rgba(147, 51, 234, 1)"},"&.Mui-disabled":{backgroundColor:"rgba(147, 51, 234, 0.3)"}},children:"Valider"})]})]})]})}},8570:function(){}}]);